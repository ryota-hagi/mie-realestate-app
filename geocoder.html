<!DOCTYPE html>
<html lang="ja">
<head>
  <meta name="description" content="ä¸‰é‡çœŒã®å°å­¦æ ¡ãƒ»ä¸­å­¦æ ¡ãªã©å­¦æ ¡ä½æ‰€ã‚’ç·¯åº¦çµŒåº¦ã«å¤‰æ›ã™ã‚‹ç°¡æ˜“ã‚¸ã‚ªã‚³ãƒ¼ãƒ€ãƒ¼ã€‚å­¦åŒºãƒ‡ãƒ¼ã‚¿æ•´å‚™ã‚„åœ°å›³é€£æºã®ä¸‹æº–å‚™ã«ä½¿ãˆã¾ã™ã€‚">
<link rel="canonical" href="https://research.chuumon-soudan.com/geocoder.html">
  <meta property="og:title" content="å­¦æ ¡ä½æ‰€ã‚¸ã‚ªã‚³ãƒ¼ãƒ€ãƒ¼ï½œä¸‰é‡ã®å­¦åŒºãƒ‡ãƒ¼ã‚¿æ•´å‚™ç”¨">
  <meta property="og:description" content="å­¦æ ¡ä½æ‰€ã‚’ç·¯åº¦çµŒåº¦ã«å¤‰æ›ã—ã¦ã€å­¦åŒºãƒ‡ãƒ¼ã‚¿ã®æ•´å‚™ã‚„åœ°å›³é€£æºã‚’æ¥½ã«ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚">
<meta property="og:image" content="https://research.chuumon-soudan.com/assets/ogp.png">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="630">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="å­¦æ ¡ä½æ‰€ã‚¸ã‚ªã‚³ãƒ¼ãƒ€ãƒ¼ï½œä¸‰é‡ã®å­¦åŒºãƒ‡ãƒ¼ã‚¿æ•´å‚™ç”¨ | æ³¨æ–‡ç›¸è«‡.com">
<meta name="twitter:description" content="ä¸‰é‡çœŒã®å°å­¦æ ¡ãƒ»ä¸­å­¦æ ¡ãªã©å­¦æ ¡ä½æ‰€ã‚’ç·¯åº¦çµŒåº¦ã«å¤‰æ›ã™ã‚‹ç°¡æ˜“ã‚¸ã‚ªã‚³ãƒ¼ãƒ€ãƒ¼ã€‚å­¦åŒºãƒ‡ãƒ¼ã‚¿æ•´å‚™ã‚„åœ°å›³é€£æºã®ä¸‹æº–å‚™ã«ä½¿ãˆã¾ã™ã€‚">
<meta name="twitter:image" content="https://research.chuumon-soudan.com/assets/ogp.png">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://research.chuumon-soudan.com/geocoder.html">
  <meta property="og:site_name" content="æ³¨æ–‡ç›¸è«‡.com">
<meta charset="UTF-8">
<title>å­¦æ ¡ä½æ‰€ã‚¸ã‚ªã‚³ãƒ¼ãƒ€ãƒ¼ï½œä¸‰é‡ã®å­¦åŒºãƒ‡ãƒ¼ã‚¿æ•´å‚™ç”¨ | æ³¨æ–‡ç›¸è«‡.com</title>
<style>
body { font-family: sans-serif; max-width: 900px; margin: 20px auto; padding: 0 20px; }
h1 { color: #333; }
table { border-collapse: collapse; width: 100%; margin-top: 10px; }
th, td { border: 1px solid #ccc; padding: 6px 10px; text-align: left; font-size: 13px; }
th { background: #f0f0f0; }
.status-ok { color: green; font-weight: bold; }
.status-err { color: red; }
.status-wait { color: gray; }
button { padding: 10px 20px; font-size: 16px; cursor: pointer; margin: 10px 5px; }
#result-json { width: 100%; height: 200px; font-family: monospace; font-size: 12px; margin-top: 10px; }
.info { background: #fffbe6; border: 1px solid #e6d54e; padding: 10px; border-radius: 5px; margin: 10px 0; }
</style>
</head>
<body>
<h1>ğŸ« å­¦æ ¡ä½æ‰€ â†’ åº§æ¨™å¤‰æ›ãƒ„ãƒ¼ãƒ«</h1>
<div class="info">
  <strong>ä½¿ã„æ–¹:</strong> ã€Œã‚¸ã‚ªã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°é–‹å§‹ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€å„å­¦æ ¡ã®ä½æ‰€ã‹ã‚‰GSIï¼ˆå›½åœŸåœ°ç†é™¢ï¼‰APIã§åº§æ¨™ã‚’å–å¾—ã—ã¾ã™ã€‚
  å®Œäº†å¾Œã€çµæœã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ä½¿ãˆã¾ã™ã€‚
</div>

<button onclick="startGeocoding()">ã‚¸ã‚ªã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°é–‹å§‹</button>
<button onclick="copyResult()">çµæœã‚’ã‚³ãƒ”ãƒ¼</button>
<span id="progress"></span>

<table>
<thead>
  <tr><th>#</th><th>å­¦æ ¡å</th><th>ä½æ‰€</th><th>ç·¯åº¦</th><th>çµŒåº¦</th><th>çŠ¶æ…‹</th></tr>
</thead>
<tbody id="school-table">
</tbody>
</table>

<h3>Pythonè¾æ›¸å½¢å¼ï¼ˆã‚³ãƒ”ãƒ¼ç”¨ï¼‰</h3>
<textarea id="result-json" readonly></textarea>

<script>
const schools = [
  { name: "è‹¥æ¾å°å­¦æ ¡", address: "ä¸‰é‡çœŒéˆ´é¹¿å¸‚è‹¥æ¾ä¸­1ä¸ç›®4-1" },
  { name: "ä¸€ãƒå®®å°å­¦æ ¡", address: "ä¸‰é‡çœŒéˆ´é¹¿å¸‚ä¸€ãƒå®®ç”º557" },
  { name: "ç®•ç”°å°å­¦æ ¡", address: "ä¸‰é‡çœŒéˆ´é¹¿å¸‚ç®•ç”°ç”º1268" },
  { name: "åŠ ä½ç™»å°å­¦æ ¡", address: "ä¸‰é‡çœŒéˆ´é¹¿å¸‚é«˜å¡šç”º1069" },
  { name: "åº„å†…å°å­¦æ ¡", address: "ä¸‰é‡çœŒéˆ´é¹¿å¸‚æ±åº„å†…ç”º2458-1" },
  { name: "éƒ¡å±±å°å­¦æ ¡", address: "ä¸‰é‡çœŒéˆ´é¹¿å¸‚éƒ¡å±±ç”º710-6" },
  { name: "å¤©åå°å­¦æ ¡", address: "ä¸‰é‡çœŒéˆ´é¹¿å¸‚å¾¡è–—ç”º2500" },
  { name: "äº•ç”°å·å°å­¦æ ¡", address: "ä¸‰é‡çœŒéˆ´é¹¿å¸‚å’Œæ³‰ç”º814" },
  { name: "ä¹…é–“ç”°å°å­¦æ ¡", address: "ä¸‰é‡çœŒéˆ´é¹¿å¸‚åœ°å­ç”º523" },
  { name: "æ¡‘åå°å­¦æ ¡", address: "ä¸‰é‡çœŒæ¡‘åå¸‚å‰ä¹‹ä¸¸8" },
  { name: "ä¿®å¾³å°å­¦æ ¡", address: "ä¸‰é‡çœŒæ¡‘åå¸‚è±ç”º48" },
  { name: "æ—¥é€²å°å­¦æ ¡", address: "ä¸‰é‡çœŒæ¡‘åå¸‚å¤ªå¤«196" },
  { name: "æ·±è°·å°å­¦æ ¡", address: "ä¸‰é‡çœŒæ¡‘åå¸‚æ±æ–¹èŠå±±2550" },
  { name: "åŸå—å°å­¦æ ¡", address: "ä¸‰é‡çœŒæ¡‘åå¸‚å—é­šç”º86" },
  { name: "å¤šåº¦é’è‘‰å°å­¦æ ¡", address: "ä¸‰é‡çœŒæ¡‘åå¸‚å¤šåº¦ç”ºå¤šåº¦1-6" },
  { name: "å¤šåº¦ä¸­å°å­¦æ ¡", address: "ä¸‰é‡çœŒæ¡‘åå¸‚å¤šåº¦ç”ºå¤é‡660" },
  { name: "å¤šåº¦æ±å°å­¦æ ¡", address: "ä¸‰é‡çœŒæ¡‘åå¸‚å¤šåº¦ç”ºä¸‹é‡ä»£2468" },
  { name: "è—¤ãŒä¸˜å°å­¦æ ¡", address: "ä¸‰é‡çœŒæ¡‘åå¸‚è—¤ãŒä¸˜4-22" },
];

// ãƒ†ãƒ¼ãƒ–ãƒ«åˆæœŸåŒ–
const tbody = document.getElementById('school-table');
schools.forEach((s, i) => {
  const tr = document.createElement('tr');
  tr.id = `row-${i}`;
  tr.innerHTML = `<td>${i+1}</td><td>${s.name}</td><td>${s.address}</td><td id="lat-${i}">-</td><td id="lng-${i}">-</td><td id="st-${i}" class="status-wait">å¾…æ©Ÿä¸­</td>`;
  tbody.appendChild(tr);
});

async function geocodeGSI(address) {
  const url = `https://msearch.gsi.go.jp/address-search/AddressSearch?q=${encodeURIComponent(address)}`;
  const resp = await fetch(url);
  const data = await resp.json();
  if (data && data.length > 0) {
    const coords = data[0].geometry.coordinates; // [lng, lat]
    return { lat: coords[1], lng: coords[0], title: data[0].properties.title };
  }
  return null;
}

async function geocodeNominatim(address) {
  const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address)}&limit=1`;
  const resp = await fetch(url, { headers: { 'User-Agent': 'MieSchoolGeocoder/1.0' }});
  const data = await resp.json();
  if (data && data.length > 0) {
    return { lat: parseFloat(data[0].lat), lng: parseFloat(data[0].lon) };
  }
  return null;
}

async function startGeocoding() {
  const results = {};
  const progress = document.getElementById('progress');

  for (let i = 0; i < schools.length; i++) {
    const s = schools[i];
    document.getElementById(`st-${i}`).textContent = 'æ¤œç´¢ä¸­...';
    document.getElementById(`st-${i}`).className = 'status-wait';
    progress.textContent = `${i+1}/${schools.length} å‡¦ç†ä¸­...`;

    let result = null;
    try {
      // ã¾ãšGSI APIã‚’è©¦ã™
      result = await geocodeGSI(s.address);
      if (!result) {
        // GSIã§è¦‹ã¤ã‹ã‚‰ãªã‘ã‚Œã°Nominatimã‚’è©¦ã™
        result = await geocodeNominatim(s.address);
      }
    } catch(e) {
      console.error(`Error geocoding ${s.name}:`, e);
    }

    if (result) {
      document.getElementById(`lat-${i}`).textContent = result.lat.toFixed(8);
      document.getElementById(`lng-${i}`).textContent = result.lng.toFixed(8);
      document.getElementById(`st-${i}`).textContent = 'âœ“ æˆåŠŸ';
      document.getElementById(`st-${i}`).className = 'status-ok';
      results[s.name] = [result.lat, result.lng];
    } else {
      document.getElementById(`st-${i}`).textContent = 'âœ— å¤±æ•—';
      document.getElementById(`st-${i}`).className = 'status-err';
    }

    // ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚’é¿ã‘ã‚‹ï¼ˆ1ç§’å¾…æ©Ÿï¼‰
    await new Promise(r => setTimeout(r, 1000));
  }

  // Pythonè¾æ›¸å½¢å¼ã§å‡ºåŠ›
  let pyDict = "verified_coords = {\n";
  for (const [name, [lat, lng]] of Object.entries(results)) {
    pyDict += `    "${name}": (${lat}, ${lng}),\n`;
  }
  pyDict += "}";
  document.getElementById('result-json').value = pyDict;
  progress.textContent = `å®Œäº†ï¼ ${Object.keys(results).length}/${schools.length} æ ¡ã®åº§æ¨™ã‚’å–å¾—`;
}

function copyResult() {
  const ta = document.getElementById('result-json');
  ta.select();
  document.execCommand('copy');
  alert('ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼');
}
</script>
</body>
</html>